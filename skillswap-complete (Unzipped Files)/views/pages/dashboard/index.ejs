<%# Dashboard - Main dashboard page for authenticated users %>

<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="dashboard-welcome">
      <h1>Welcome back, <%= user.firstName %>!</h1>
      <p class="text-muted">Here's what's happening with your SkillSwap activity</p>
    </div>
    <div class="dashboard-actions">
      <a href="/explore" class="btn btn-primary">
        <i data-lucide="search"></i>
        Find Tutors
      </a>
      <% if (user.role === 'tutor' || user.role === 'admin') { %>
        <a href="/sessions/availability" class="btn btn-outline">
          <i data-lucide="calendar"></i>
          Set Availability
        </a>
      <% } %>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon" style="background: var(--primary-100); color: var(--primary-600);">
        <i data-lucide="book-open"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= stats.totalSessions || 0 %></span>
        <span class="stat-label">Total Sessions</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon" style="background: var(--success-100); color: var(--success-600);">
        <i data-lucide="check-circle"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= stats.completedSessions || 0 %></span>
        <span class="stat-label">Completed</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon" style="background: var(--warning-100); color: var(--warning-600);">
        <i data-lucide="clock"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= stats.upcomingSessions || 0 %></span>
        <span class="stat-label">Upcoming</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon" style="background: var(--accent-100); color: var(--accent-600);">
        <i data-lucide="star"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= user.averageRating ? user.averageRating.toFixed(1) : 'N/A' %></span>
        <span class="stat-label">Rating</span>
      </div>
    </div>
  </div>

  <div class="dashboard-grid">
    <!-- Upcoming Sessions -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>
          <i data-lucide="calendar"></i>
          Upcoming Sessions
        </h2>
        <a href="/sessions" class="btn btn-sm btn-ghost">View All</a>
      </div>
      
      <div class="session-list">
        <% if (upcomingSessions && upcomingSessions.length > 0) { %>
          <% upcomingSessions.forEach(session => { %>
            <div class="session-card-mini">
              <div class="session-date">
                <span class="date-day"><%= new Date(session.scheduledDate).getDate() %></span>
                <span class="date-month"><%= new Date(session.scheduledDate).toLocaleDateString('en-US', { month: 'short' }) %></span>
              </div>
              <div class="session-info">
                <h4><%= session.skill %></h4>
                <p class="text-muted">
                  <% if (session.tutor._id.toString() === user._id.toString()) { %>
                    with <%= session.student.firstName %> <%= session.student.lastName %>
                  <% } else { %>
                    with <%= session.tutor.firstName %> <%= session.tutor.lastName %>
                  <% } %>
                </p>
                <span class="session-time">
                  <i data-lucide="clock" class="icon-xs"></i>
                  <%= session.startTime %> - <%= session.endTime %>
                </span>
              </div>
              <div class="session-actions">
                <a href="/sessions/<%= session._id %>" class="btn btn-sm btn-outline">Details</a>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="empty-state">
            <i data-lucide="calendar-x"></i>
            <p>No upcoming sessions</p>
            <a href="/explore" class="btn btn-sm btn-primary">Find a Tutor</a>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Pending Requests -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>
          <i data-lucide="inbox"></i>
          Pending Requests
        </h2>
        <a href="/sessions?status=pending" class="btn btn-sm btn-ghost">View All</a>
      </div>
      
      <div class="request-list">
        <% if (pendingRequests && pendingRequests.length > 0) { %>
          <% pendingRequests.forEach(request => { %>
            <div class="request-card">
              <div class="request-user">
                <div class="avatar avatar-sm">
                  <% if (request.student.avatar) { %>
                    <img src="<%= request.student.avatar %>" alt="<%= request.student.firstName %>">
                  <% } else { %>
                    <span><%= request.student.firstName.charAt(0) %><%= request.student.lastName.charAt(0) %></span>
                  <% } %>
                </div>
                <div>
                  <h4><%= request.student.firstName %> <%= request.student.lastName %></h4>
                  <p class="text-muted text-sm">wants help with <strong><%= request.skill %></strong></p>
                </div>
              </div>
              <div class="request-meta">
                <span class="text-sm text-muted">
                  <%= new Date(request.scheduledDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %>
                  at <%= request.startTime %>
                </span>
              </div>
              <div class="request-actions">
                <form action="/sessions/<%= request._id %>/respond" method="POST" class="inline-form">
                  <input type="hidden" name="action" value="accept">
                  <button type="submit" class="btn btn-sm btn-success">Accept</button>
                </form>
                <form action="/sessions/<%= request._id %>/respond" method="POST" class="inline-form">
                  <input type="hidden" name="action" value="decline">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Decline</button>
                </form>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="empty-state">
            <i data-lucide="inbox"></i>
            <p>No pending requests</p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>
          <i data-lucide="activity"></i>
          Recent Activity
        </h2>
      </div>
      
      <div class="activity-feed">
        <% if (recentActivity && recentActivity.length > 0) { %>
          <% recentActivity.forEach(activity => { %>
            <div class="activity-item">
              <div class="activity-icon activity-icon-<%= activity.type %>">
                <% if (activity.type === 'session_completed') { %>
                  <i data-lucide="check-circle"></i>
                <% } else if (activity.type === 'review_received') { %>
                  <i data-lucide="star"></i>
                <% } else if (activity.type === 'session_booked') { %>
                  <i data-lucide="calendar-plus"></i>
                <% } else if (activity.type === 'message_received') { %>
                  <i data-lucide="message-circle"></i>
                <% } else { %>
                  <i data-lucide="bell"></i>
                <% } %>
              </div>
              <div class="activity-content">
                <p><%= activity.message %></p>
                <span class="activity-time text-muted text-sm">
                  <%= activity.createdAt ? new Date(activity.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' }) : '' %>
                </span>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="empty-state">
            <i data-lucide="activity"></i>
            <p>No recent activity</p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>
          <i data-lucide="zap"></i>
          Quick Actions
        </h2>
      </div>
      
      <div class="quick-actions-grid">
        <a href="/explore" class="quick-action-card">
          <i data-lucide="search"></i>
          <span>Find Tutors</span>
        </a>
        <a href="/messages" class="quick-action-card">
          <i data-lucide="message-square"></i>
          <span>Messages</span>
          <% if (unreadMessages > 0) { %>
            <span class="badge badge-danger"><%= unreadMessages %></span>
          <% } %>
        </a>
        <a href="/profile/edit" class="quick-action-card">
          <i data-lucide="user-cog"></i>
          <span>Edit Profile</span>
        </a>
        <a href="/sessions/history" class="quick-action-card">
          <i data-lucide="history"></i>
          <span>Session History</span>
        </a>
        <% if (user.role === 'student') { %>
          <a href="/profile/upgrade" class="quick-action-card">
            <i data-lucide="trending-up"></i>
            <span>Become a Tutor</span>
          </a>
        <% } %>
        <a href="/help" class="quick-action-card">
          <i data-lucide="help-circle"></i>
          <span>Get Help</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Skills Section (for tutors) -->
  <% if (user.role === 'tutor' || user.role === 'admin') { %>
    <div class="dashboard-section full-width">
      <div class="section-header">
        <h2>
          <i data-lucide="graduation-cap"></i>
          Your Teaching Skills
        </h2>
        <a href="/profile/edit#skills" class="btn btn-sm btn-outline">
          <i data-lucide="plus"></i>
          Add Skills
        </a>
      </div>
      
      <div class="skills-showcase">
        <% if (user.skills && user.skills.length > 0) { %>
          <% user.skills.forEach(skill => { %>
            <div class="skill-tag-large">
              <span class="skill-name"><%= skill.name %></span>
              <span class="skill-level badge badge-<%= skill.proficiency === 'expert' ? 'success' : skill.proficiency === 'intermediate' ? 'warning' : 'info' %>">
                <%= skill.proficiency %>
              </span>
            </div>
          <% }) %>
        <% } else { %>
          <div class="empty-state">
            <p>Add skills you can teach to start receiving tutoring requests</p>
            <a href="/profile/edit#skills" class="btn btn-primary">Add Your First Skill</a>
          </div>
        <% } %>
      </div>
    </div>
  <% } %>
</div>

<style>
  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--space-6);
  }

  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-8);
    flex-wrap: wrap;
    gap: var(--space-4);
  }

  .dashboard-welcome h1 {
    font-size: var(--text-3xl);
    margin-bottom: var(--space-2);
  }

  .dashboard-actions {
    display: flex;
    gap: var(--space-3);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-4);
    margin-bottom: var(--space-8);
  }

  .stat-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
    display: flex;
    align-items: center;
    gap: var(--space-4);
    box-shadow: var(--shadow-sm);
    transition: var(--transition-base);
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .stat-content {
    display: flex;
    flex-direction: column;
  }

  .stat-value {
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--neutral-900);
  }

  .stat-label {
    font-size: var(--text-sm);
    color: var(--neutral-500);
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-6);
  }

  .dashboard-section {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
    box-shadow: var(--shadow-sm);
  }

  .dashboard-section.full-width {
    grid-column: 1 / -1;
    margin-top: var(--space-6);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-3);
    border-bottom: 1px solid var(--neutral-200);
  }

  .section-header h2 {
    font-size: var(--text-lg);
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .session-card-mini {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4);
    border-radius: var(--radius-md);
    background: var(--neutral-50);
    margin-bottom: var(--space-3);
    transition: var(--transition-base);
  }

  .session-card-mini:hover {
    background: var(--neutral-100);
  }

  .session-date {
    text-align: center;
    min-width: 50px;
    padding: var(--space-2);
    background: var(--primary-100);
    border-radius: var(--radius-md);
  }

  .date-day {
    display: block;
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--primary-700);
  }

  .date-month {
    display: block;
    font-size: var(--text-xs);
    text-transform: uppercase;
    color: var(--primary-600);
  }

  .session-info {
    flex: 1;
  }

  .session-info h4 {
    margin-bottom: var(--space-1);
  }

  .session-time {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-sm);
    color: var(--neutral-500);
    margin-top: var(--space-1);
  }

  .request-card {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4);
    border-radius: var(--radius-md);
    background: var(--neutral-50);
    margin-bottom: var(--space-3);
    flex-wrap: wrap;
  }

  .request-user {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    flex: 1;
    min-width: 200px;
  }

  .request-actions {
    display: flex;
    gap: var(--space-2);
  }

  .inline-form {
    display: inline;
  }

  .activity-feed {
    max-height: 300px;
    overflow-y: auto;
  }

  .activity-item {
    display: flex;
    gap: var(--space-3);
    padding: var(--space-3) 0;
    border-bottom: 1px solid var(--neutral-100);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .activity-icon-session_completed {
    background: var(--success-100);
    color: var(--success-600);
  }

  .activity-icon-review_received {
    background: var(--warning-100);
    color: var(--warning-600);
  }

  .activity-icon-session_booked {
    background: var(--primary-100);
    color: var(--primary-600);
  }

  .activity-icon-message_received {
    background: var(--info-100);
    color: var(--info-600);
  }

  .activity-content {
    flex: 1;
  }

  .activity-time {
    display: block;
    margin-top: var(--space-1);
  }

  .quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--space-3);
  }

  .quick-action-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-4);
    border-radius: var(--radius-md);
    background: var(--neutral-50);
    text-decoration: none;
    color: var(--neutral-700);
    transition: var(--transition-base);
    position: relative;
  }

  .quick-action-card:hover {
    background: var(--primary-50);
    color: var(--primary-700);
    transform: translateY(-2px);
  }

  .quick-action-card .badge {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
  }

  .skills-showcase {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .skill-tag-large {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--neutral-100);
    border-radius: var(--radius-full);
  }

  .empty-state {
    text-align: center;
    padding: var(--space-8);
    color: var(--neutral-500);
  }

  .empty-state i {
    width: 48px;
    height: 48px;
    margin-bottom: var(--space-3);
    opacity: 0.5;
  }

  .empty-state .btn {
    margin-top: var(--space-4);
  }

  @media (max-width: 1024px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 640px) {
    .dashboard-container {
      padding: var(--space-4);
    }

    .dashboard-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .dashboard-actions {
      width: 100%;
    }

    .dashboard-actions .btn {
      flex: 1;
    }

    .request-card {
      flex-direction: column;
      align-items: flex-start;
    }

    .request-actions {
      width: 100%;
      justify-content: flex-end;
    }
  }
</style>
